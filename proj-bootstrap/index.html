<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de contatos</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>

<style>
    input {
        border-width: 5px;
        border-style: solid;
    }
</style>

<script>
    var posicaoReg = -1;
    $(function () {
        listarProdutos();

        $('#btnSalvar').click(function () {
            if (!validarCampos()) {
                return;
            };

            let produto = {
                nomeProduto: $('#txtNomeProduto').val(),
                qtd: $('#txtQuantidade').val(),
                valor: $('#txtValor').val(),
                descricao: $('#txtDescricao').val(),
                vendedor: $('#txtVendedor').val()
            };

            let produtos = JSON.parse(localStorage.getItem('produtos'));

            if (produtos == null) {
                produtos = []
                produtos.push(produto);
            }
            else {
                if (posicaoReg > -1) {
                    produtos[posicaoReg] = produto
                } else {
                    produtos.push(produto);
                }
            };

            localStorage.setItem('produtos', JSON.stringify(produtos));

            $('input').val('');
            $('#txtNomeProduto').focus();

            listarProdutos();

            posicaoReg = -1;
        });
    });

    $(document).on('click', '#btnEditar', function () {
        if (!validarCampos()) {
            return;
        };

        let posicao = parseInt($(this).attr("alt"))
        posicaoReg = posicao
        let produtos = JSON.parse(localStorage.getItem('produtos'))

        let produto = produtos[posicao]

        $('#txtNomeProduto').val(produto.nomeProduto)
        $('#txtQuantidade').val(produto.qtd)
        $('#txtValor').val(produto.valor)
        $('#txtDescricao').val(produto.descricao)
        $('#txtVendedor').val(produto.vendedor)
    });

    $(document).on('click', '#btnExcluir', function () {
        let posicao = parseInt($(this).attr("alt"))
        posicaoReg = posicao
        let produtos = JSON.parse(localStorage.getItem('produtos'))

        if (posicaoReg > -1) {
            let produto = produtos[posicao]
            if (confirm('Deseja realmente excluir o produto "' + produto.nomeProduto + '"')) {
                produtos.splice(posicaoReg, 1)
                localStorage.setItem('produtos', JSON.stringify(produtos))
                listarProdutos();
            }
            posicaoReg = -1;
        } else {
            alert('Não há registros para excluir!')
            return
        };
    });

    function listarProdutos() {
        $('#tblProdutos tr:not(:first)').remove();
        var produtos = JSON.parse(localStorage.getItem('produtos'));

        for (let posicao in produtos) {
            let produto = produtos[posicao]

            $('#tblProdutos tr:last').after('<tr><td>' + produto.nomeProduto +
                '</td><td>' + produto.qtd +
                '</td><td>' + produto.valor +
                '</td><td>' + produto.descricao +
                '</td><td>' + produto.vendedor +
                '</td><td>' + '<button id="btnEditar" alt="' + posicao + '" class="btn btn-info btn-sm">Editar</button> ' +
                '<button id="btnExcluir" alt="' + posicao + '" class="btn btn-info btn-sm">Excluir</button>' +
                '</td></tr>')
        }
    };

    function validarCampos() {
        if ($.trim($('#txtNomeProduto').val()) == '') {
            alert('Nome não preenchido')
            $('#txtNomeProduto').focus();
            return false
        } else
            if (($.trim($('#txtQuantidade').val()) == '') || ($('#txtQuantidade').val() <= 0)) {
                alert('Quantidade não ser zero ou negativo')
                $('#txtQuantidade').focus();
                return false
            } else
                if (($.trim($('#txtValor').val()) == '') || ($('#txtValor').val() <= 0)) {
                    alert('Valor não ser zero ou negativo')
                    $('#txtValor').focus();
                    return false
                }
                else
                    if ($.trim($('#txtDescricao').val()) == '') {
                        alert('Descrição não preenchido')
                        $('#txtDescricao').focus();
                        return false
                    } else
                        if ($.trim($('#txtVendedor').val()) == '') {
                            alert('Vendedor não preenchido')
                            $('#txtVendedor').focus();
                            return false
                        } else
                            return true;
    }
</script>

<body>
    <div class="container">
        <div class="row">
            <div class="panel panel-info">
                <div class="panel-heading text-center">
                    <h1><strong>Lista de produtos</strong></h1>
                </div>
                <div class="panel-body">
                    <div class="col-xs-12 col-md-4 col-lg-6">
                        <label for="txtNomeProduto">Nome do produto</label>
                        <input id="txtNomeProduto" type="text" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-2 col-lg-2">
                        <label for="txtQuantidade">Quantidade</label>
                        <input id="txtQuantidade" type="number" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-3 col-lg-4">
                        <label for="txtValor">Valor</label>
                        <input id="txtValor" type="number" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-4 col-lg-6">
                        <label for="txtDescricao">Descrição</label>
                        <input id="txtDescricao" type="text" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-2 col-lg-4">
                        <label for="txtVendedor">Vendedor</label>
                        <input id="txtVendedor" type="text" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-2 col-lg-2">
                        <br>
                        <button id="btnSalvar" type="button" class="btn btn-primary">Salvar</button>
                    </div>
                    <br>
                    <hr>
                    <br>
                    <hr>
                    <table id="tblProdutos" class="table table-striped table-responsive table-hover">

                        <body>
                            <th>Nome Prod.</th>
                            <th>Qtde.</th>
                            <th>Valor</th>
                            <th>Descr.</th>
                            <th>Vendedor</th>
                            <th colspan="2" align="center">Ações</th>
                            </tr>
                        </body>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>

</html>